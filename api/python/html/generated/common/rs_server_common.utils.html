<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rs_server_common.utils package &mdash; rs-server  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="rs_server_cadip" href="../cadip/modules.html" />
    <link rel="prev" title="rs_server_common.schemas package" href="rs_server_common.schemas.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            rs-server
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">RS Server commons</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="rs_server_common.html">rs_server_common package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="rs_server_common.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="rs_server_common.data_retrieval.html">rs_server_common.data_retrieval package</a></li>
<li class="toctree-l4"><a class="reference internal" href="rs_server_common.db.html">rs_server_common.db package</a></li>
<li class="toctree-l4"><a class="reference internal" href="rs_server_common.s3_storage_handler.html">rs_server_common.s3_storage_handler package</a></li>
<li class="toctree-l4"><a class="reference internal" href="rs_server_common.schemas.html">rs_server_common.schemas package</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">rs_server_common.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rs_server_common.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="rs_server_common.html#module-rs_server_common.fastapi_app">rs_server_common.fastapi_app module</a></li>
<li class="toctree-l3"><a class="reference internal" href="rs_server_common.html#module-rs_server_common">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cadip/modules.html">RS Server cadip service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adgs/modules.html">RS Server adgs service</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">rs-server</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">rs_server_common</a></li>
          <li class="breadcrumb-item"><a href="rs_server_common.html">rs_server_common package</a></li>
      <li class="breadcrumb-item active">rs_server_common.utils package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/generated/common/rs_server_common.utils.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rs-server-common-utils-package">
<h1>rs_server_common.utils package<a class="headerlink" href="#rs-server-common-utils-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-rs_server_common.utils.logging">
<span id="rs-server-common-utils-logging-module"></span><h2>rs_server_common.utils.logging module<a class="headerlink" href="#module-rs_server_common.utils.logging" title="Link to this heading"></a></h2>
<p>Logging utility.</p>
<dl class="py class">
<dt class="sig sig-object py" id="rs_server_common.utils.logging.CustomFormatter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.logging.</span></span><span class="sig-name descname"><span class="pre">CustomFormatter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fmt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datefmt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">style</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'%'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defaults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rs_server_common.utils.logging.CustomFormatter" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Formatter</span></code></p>
<p>Custom logging formatter with colored text.
See: <a class="reference external" href="https://stackoverflow.com/a/56944256">https://stackoverflow.com/a/56944256</a></p>
<dl class="py method">
<dt class="sig sig-object py" id="rs_server_common.utils.logging.CustomFormatter.format">
<span class="sig-name descname"><span class="pre">format</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rs_server_common.utils.logging.CustomFormatter.format" title="Link to this definition"></a></dt>
<dd><p>Format the specified record as text.</p>
<p>The record’s attribute dictionary is used as the operand to a
string formatting operation which yields the returned string.
Before formatting the dictionary, a couple of preparatory steps
are carried out. The message attribute of the record is computed
using LogRecord.getMessage(). If the formatting string uses the
time (as determined by a call to usesTime(), formatTime() is
called to format the event time. If there is exception information,
it is formatted using formatException() and appended to the message.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="rs_server_common.utils.logging.Logging">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.logging.</span></span><span class="sig-name descname"><span class="pre">Logging</span></span><a class="headerlink" href="#rs_server_common.utils.logging.Logging" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Logging utility.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="rs_server_common.utils.logging.Logging.lock">
<span class="sig-name descname"><span class="pre">lock</span></span><a class="headerlink" href="#rs_server_common.utils.logging.Logging.lock" title="Link to this definition"></a></dt>
<dd><p>For code synchronization</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="rs_server_common.utils.logging.Logging.level">
<span class="sig-name descname"><span class="pre">level</span></span><a class="headerlink" href="#rs_server_common.utils.logging.Logging.level" title="Link to this definition"></a></dt>
<dd><p>Minimal log level to use for all new logging instances.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="rs_server_common.utils.logging.Logging.default">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">default</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'rspy'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rs_server_common.utils.logging.Logging.default" title="Link to this definition"></a></dt>
<dd><p>Return a default Logger class instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – Logger name. You can pass __name__ to use your current module name.</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id0">
<span class="sig-name descname"><span class="pre">level</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">10</span></em><a class="headerlink" href="#id0" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id1">
<span class="sig-name descname"><span class="pre">lock</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;unlocked</span> <span class="pre">_thread.lock</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#id1" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-rs_server_common.utils.provider_ws_address">
<span id="rs-server-common-utils-provider-ws-address-module"></span><h2>rs_server_common.utils.provider_ws_address module<a class="headerlink" href="#module-rs_server_common.utils.provider_ws_address" title="Link to this heading"></a></h2>
<p>TODO Docstring will be added here</p>
<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.provider_ws_address.station_to_server_url">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.provider_ws_address.</span></span><span class="sig-name descname"><span class="pre">station_to_server_url</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">station</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#rs_server_common.utils.provider_ws_address.station_to_server_url" title="Link to this definition"></a></dt>
<dd><p>Retrieve the configuration data (webserver address) for a CADIP station based on its identifier.</p>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The station identifier is case-insensitive and is converted to uppercase for matching.</p></li>
<li><p>The function reads the station configuration data from a JSON file.</p></li>
<li><p>If the station identifier is not found in the configuration data, the function returns None.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>station</strong> (<em>str</em>) – Identifier for the CADIP station.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A str containing the webserver address for the specified station,
or None if the station identifier is not found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str or None</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-rs_server_common.utils.utils">
<span id="rs-server-common-utils-utils-module"></span><h2>rs_server_common.utils.utils module<a class="headerlink" href="#module-rs_server_common.utils.utils" title="Link to this heading"></a></h2>
<p>This module is used to share common functions between apis endpoints</p>
<dl class="py class">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.EoDAGDownloadHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">EoDAGDownloadHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="rs_server_common.db.models.html#rs_server_common.db.models.download_status.DownloadStatus" title="rs_server_common.db.models.download_status.DownloadStatus"><span class="pre">DownloadStatus</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">thread_started</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">station</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">product_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">local</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rs_server_common.utils.utils.EoDAGDownloadHandler" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Dataclass to store arguments needed for eodag download.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.EoDAGDownloadHandler.db_handler">
<span class="sig-name descname"><span class="pre">db_handler</span></span><a class="headerlink" href="#rs_server_common.utils.utils.EoDAGDownloadHandler.db_handler" title="Link to this definition"></a></dt>
<dd><p>An instance used to access the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="rs_server_common.db.models.html#rs_server_common.db.models.download_status.DownloadStatus" title="rs_server_common.db.models.download_status.DownloadStatus">DownloadStatus</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.EoDAGDownloadHandler.thread_started">
<span class="sig-name descname"><span class="pre">thread_started</span></span><a class="headerlink" href="#rs_server_common.utils.utils.EoDAGDownloadHandler.thread_started" title="Link to this definition"></a></dt>
<dd><p>Event to signal the start of the download thread.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>threading.Event</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.EoDAGDownloadHandler.station">
<span class="sig-name descname"><span class="pre">station</span></span><a class="headerlink" href="#rs_server_common.utils.utils.EoDAGDownloadHandler.station" title="Link to this definition"></a></dt>
<dd><p>Station identifier (needed only for CADIP).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.EoDAGDownloadHandler.product_id">
<span class="sig-name descname"><span class="pre">product_id</span></span><a class="headerlink" href="#rs_server_common.utils.utils.EoDAGDownloadHandler.product_id" title="Link to this definition"></a></dt>
<dd><p>Identifier of the product to be downloaded.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.EoDAGDownloadHandler.name">
<span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#rs_server_common.utils.utils.EoDAGDownloadHandler.name" title="Link to this definition"></a></dt>
<dd><p>Filename of the file to be downloaded.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.EoDAGDownloadHandler.local">
<span class="sig-name descname"><span class="pre">local</span></span><a class="headerlink" href="#rs_server_common.utils.utils.EoDAGDownloadHandler.local" title="Link to this definition"></a></dt>
<dd><p>Local path where the product will be stored</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.EoDAGDownloadHandler.obs">
<span class="sig-name descname"><span class="pre">obs</span></span><a class="headerlink" href="#rs_server_common.utils.utils.EoDAGDownloadHandler.obs" title="Link to this definition"></a></dt>
<dd><p>Path to the S3 storage where the file will be uploaded</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id2">
<span class="sig-name descname"><span class="pre">db_handler</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="rs_server_common.db.models.html#rs_server_common.db.models.download_status.DownloadStatus" title="rs_server_common.db.models.download_status.DownloadStatus"><span class="pre">DownloadStatus</span></a></em><a class="headerlink" href="#id2" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id3">
<span class="sig-name descname"><span class="pre">local</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#id3" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id4">
<span class="sig-name descname"><span class="pre">name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#id4" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id5">
<span class="sig-name descname"><span class="pre">obs</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#id5" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id6">
<span class="sig-name descname"><span class="pre">product_id</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#id6" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id7">
<span class="sig-name descname"><span class="pre">station</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#id7" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="id8">
<span class="sig-name descname"><span class="pre">thread_started</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Event</span></em><a class="headerlink" href="#id8" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.create_stac_collection">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">create_stac_collection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">products</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">EOProduct</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_template</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stac_mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#rs_server_common.utils.utils.create_stac_collection" title="Link to this definition"></a></dt>
<dd><p>This function create a STAC feature for each EOProduct based on a given template</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.eodag_download">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">eodag_download</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">argument</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#rs_server_common.utils.utils.EoDAGDownloadHandler" title="rs_server_common.utils.utils.EoDAGDownloadHandler"><span class="pre">EoDAGDownloadHandler</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_provider</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="rs_server_common.data_retrieval.html#rs_server_common.data_retrieval.provider.Provider" title="rs_server_common.data_retrieval.provider.Provider"><span class="pre">Provider</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rs_server_common.utils.utils.eodag_download" title="Link to this definition"></a></dt>
<dd><p>Start the eodag download process.</p>
<p>This function initiates the eodag download process using the provided arguments. It sets up
the necessary configurations, starts the download thread, and updates the download status in the
database based on the outcome of the download.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>argument</strong> (<a class="reference internal" href="#rs_server_common.utils.utils.EoDAGDownloadHandler" title="rs_server_common.utils.utils.EoDAGDownloadHandler"><em>EoDAGDownloadHandler</em></a>) – An instance of EoDAGDownloadHandler containing
the arguments used in the downloading process</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The local and obs parameters are optionals:
- local (str | None): Local path where the product will be stored. If this</p>
<blockquote>
<div><p>parameter is not given, the local path where the file is stored will be set to a temporary one</p>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>obs (str | None): Path to S3 storage where the file will be uploaded, after a successfull download from CADIP</dt><dd><p>server. If this parameter is not given, the file will not be uploaded to the s3 storage.</p>
</dd>
</dl>
</li>
</ul>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – If there is an issue connecting to the S3 storage during the download.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.extract_eo_product">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">extract_eo_product</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eo_product</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">EOProduct</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#rs_server_common.utils.utils.extract_eo_product" title="Link to this definition"></a></dt>
<dd><p>This function is creating key:value pairs from an EOProduct properties</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.is_valid_date_format">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">is_valid_date_format</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#rs_server_common.utils.utils.is_valid_date_format" title="Link to this definition"></a></dt>
<dd><p>Check if a string adheres to the expected date format “YYYY-MM-DDTHH:MM:SS.sssZ”.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>date</strong> (<em>str</em>) – The string to be validated for the specified date format.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the input string adheres to the expected date format, otherwise False.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.odata_to_stac">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">odata_to_stac</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_template</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">odata_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">odata_stac_mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#rs_server_common.utils.utils.odata_to_stac" title="Link to this definition"></a></dt>
<dd><p>This function is used to map odata values to a given STAC template</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.sort_feature_collection">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">sort_feature_collection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_collection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sortby</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#rs_server_common.utils.utils.sort_feature_collection" title="Link to this definition"></a></dt>
<dd><p>This function sorts a STAC feature collection based on a given criteria</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.update_db">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">update_db</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_product</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="rs_server_common.db.models.html#rs_server_common.db.models.download_status.DownloadStatus" title="rs_server_common.db.models.download_status.DownloadStatus"><span class="pre">DownloadStatus</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">estatus</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="rs_server_common.db.models.html#rs_server_common.db.models.download_status.EDownloadStatus" title="rs_server_common.db.models.download_status.EDownloadStatus"><span class="pre">EDownloadStatus</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">status_fail_message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rs_server_common.utils.utils.update_db" title="Link to this definition"></a></dt>
<dd><p>Update the download status of a product in the database.</p>
<p>This function attempts to update the download status of a product in the database.
It retries the update operation for a maximum of three times, waiting 1 second between attempts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<em>sqlalchemy.orm.Session</em>) – The database session.</p></li>
<li><p><strong>db_product</strong> (<a class="reference internal" href="rs_server_common.db.models.html#rs_server_common.db.models.download_status.DownloadStatus" title="rs_server_common.db.models.download_status.DownloadStatus"><em>DownloadStatus</em></a>) – The product whose status needs to be updated.</p></li>
<li><p><strong>estatus</strong> (<a class="reference internal" href="rs_server_common.db.models.html#rs_server_common.db.models.download_status.EDownloadStatus" title="rs_server_common.db.models.download_status.EDownloadStatus"><em>EDownloadStatus</em></a>) – The new download status.</p></li>
<li><p><strong>status_fail_message</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – An optional message associated with the failure status.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>sqlalchemy.exc.OperationalError</strong> – If the database update operation fails after multiple attempts.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">update_db</span><span class="p">(</span><span class="n">db_session</span><span class="p">,</span> <span class="n">product_instance</span><span class="p">,</span> <span class="n">EDownloadStatus</span><span class="o">.</span><span class="n">DONE</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>This function is designed to update the download status in the database.</p></li>
<li><p>It retries the update operation for a maximum of three times.</p></li>
<li><p>If the update fails, an exception is raised, indicating an issue with the database.</p></li>
</ul>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.validate_inputs_format">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">validate_inputs_format</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">datetime</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">datetime</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#rs_server_common.utils.utils.validate_inputs_format" title="Link to this definition"></a></dt>
<dd><p>Validate the format of the input time interval.</p>
<p>This function checks whether the input interval has a valid format (start_date/stop_date) and
whether the start and stop dates are in a valid ISO 8601 format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>interval</strong> (<em>-</em>) – The time interval to be validated, with the following format:
“2024-01-01T00:00:00Z/2024-01-02T23:59:59Z”</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing:
- start_date (datetime): The start date of the interval.
- stop_date (datetime): The stop date of the interval.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Tuple[datetime, datetime]</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The input interval should be in the format “start_date/stop_date”</p></li>
</ul>
<p>(e.g., “2022-01-01T00:00:00Z/2022-01-02T00:00:00Z”).
- This function checks for missing start/stop and validates the ISO 8601 format of start and stop dates.
- If there is an error, err_code and err_text provide information about the issue.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rs_server_common.utils.utils.write_search_products_to_db">
<span class="sig-prename descclassname"><span class="pre">rs_server_common.utils.utils.</span></span><span class="sig-name descname"><span class="pre">write_search_products_to_db</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_handler_class</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="rs_server_common.db.models.html#rs_server_common.db.models.download_status.DownloadStatus" title="rs_server_common.db.models.download_status.DownloadStatus"><span class="pre">DownloadStatus</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">products</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">EOProduct</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#rs_server_common.utils.utils.write_search_products_to_db" title="Link to this definition"></a></dt>
<dd><p>Process a list of products by adding them to the database if not already present.</p>
<p>This function iterates over a list of products. For each product, it checks whether the product
is already registered in the database. If the product is not in the database, it is added with
its relevant details. The function collects a list of product IDs and names for further processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>products</strong> (<em>-</em>) – A list of product objects to be processed.</p></li>
<li><p><strong>db_handler_class</strong> (<em>-</em>) – The database handler class used for database operations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of tuples, each containing the ‘id’ and ‘Name’ properties of a product.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[Tuple]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>- sqlalchemy.exc.OperationalError</strong> – If there’s an issue connecting to the database.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The function assumes that ‘products’ is a list of objects with a ‘properties’ attribute,
which is a dictionary containing keys ‘id’, ‘Name’, and ‘startTimeFromAscendingNode’.</p></li>
<li><p>‘get_db’ is a context manager that provides a database session.</p></li>
<li><p>‘EDownloadStatus’ is an enumeration representing download status.</p></li>
</ul>
</div>
</dd></dl>

</section>
<section id="module-rs_server_common.utils">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-rs_server_common.utils" title="Link to this heading"></a></h2>
<p>Utility modules.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="rs_server_common.schemas.html" class="btn btn-neutral float-left" title="rs_server_common.schemas package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../cadip/modules.html" class="btn btn-neutral float-right" title="rs_server_cadip" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, CS Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>